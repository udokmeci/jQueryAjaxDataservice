"use strict";var dataservice=function(e){var t=[];var n={};var r=false;var i=true;var s=null;var o=function(e){return e};var u={route:null,method:"POST",data:null,successCallback:function(e){},completeCallback:function(){},failCallback:function(){},progressbar:e("#dataserviceProgressbar .progress-bar"),async:true,uploadProccess:function(){},downloadProccess:function(){},addQueueOnError:true,queueInterval:50,onOffline:function(){console.log("Got Offline")},onOnline:function(){console.log("Online Again")},removedFromQueue:function(){console.log("Removed")},internetCheckUrl:window.location,dontLeaveMessage:o("Request is in progress now. Please wait until it is completed to ensure not to lose data.")};var a=function(){return u.dontLeaveMessage};var f=function(){};var l=function(){};var c=function(t){t=parseInt(t*100);u.progressbar.css("width",t+"%");if(t==100){g();window.onbeforeunload=f;e(".loading-feedback").hide();u.progressbar.addClass("progress-bar-success");u.progressbar.parent().removeClass("active");u.progressbar.html(o("Completed"))}else{e(".loading-feedback").show();u.progressbar.html(sprintf(o("%s &#37;"),t));u.progressbar.parent().addClass("active");u.progressbar.removeClass("progress-bar-success")}};var h=function(e){c=e};var p=function(){window.onbeforeunload=a};var d=function(t){var n=0;var r=0;var i=0;var s=0;var o=0;var u=0;e.each(T,function(e,t){if(t.total.total==t.total.loaded){delete T[e]}else{i+=t.upload.total;s+=t.upload.loaded;o+=t.download.total;u+=t.download.loaded;n+=t.total.total;r+=t.total.loaded}});if(n==0){c(1);window.onbeforeunload=f}else{c(s/i/2+u/o/2)}};var v=function(t){e.extend(u,t);return this};var m=function(e){t.push(e)};var g=function(){if(t.length==0||!r||!i)return;var e=t.shift();if(!n[JSON.stringify(e)])n[JSON.stringify(e)]=0;if(n[JSON.stringify(e)]++>3){delete n[JSON.stringify(e)];if(e.removedFromQueue)return e.removedFromQueue();else return u.removedFromQueue()}y(e)};var y=function(t){if(!b())return m(t);r=false;if(typeof t!="undefined")v(t);var n={xhr:function(){var t=new window.XMLHttpRequest;var n=e.now();t.upload.addEventListener("progress",function(e){p();if(e.lengthComputable){T[n]={upload:{total:e.total,loaded:e.loaded},download:{total:1,loaded:0},total:{total:e.total+1,loaded:e.loaded}};d("uploading",T[n]);u.uploadProccess(T[n])}},false);t.addEventListener("progress",function(e){p();if(e.lengthComputable&&T[n]){T[n].upload.loaded=T[n].upload.total;T[n].download={total:e.total,loaded:e.loaded};T[n].total={total:e.total+T[n].upload.total,loaded:e.loaded+T[n].upload.loaded};d("downloading",T[n])}},false);return t},headers:{"X-PINGOTHER":"pingpong",contentType:"plain/text; charset=UTF-8"},type:u.method,url:"//"+window.location.host+"/"+u.route,data:u.data,async:u.async,beforeSend:function(){p()},success:function(e){d();u.successCallback(e)},error:function(e,n,i){if(!(e.status>=200&&e.status<304))S();T={};d();r=true;if(u.addQueueOnError)m(t);u.failCallback()},complete:function(){r=true;d();u.completeCallback()}};if(u.data instanceof FormData){n.processData=false;n.contentType=false}e.ajax(n)};var b=function(){return i};var w=function(){i=true;u.onOnline();E("stop");u.progressbar.removeClass("progress-bar-success")};var E=function(t){if(t=="stop")if(s)clearInterval(s);if(t=="start"){s=setInterval(function(){e.ajax({async:true,url:u.internetCheckUrl,data:{n:Math.round(Math.random()*1e4)},success:function(e){w()}})},1e3)}};var S=function(){i=false;u.onOffline();E("start");u.progressbar.addClass("progress-bar-warning")};var x=setInterval(function(){g()},u.interval);var T=new Object;var N=this;c(0);return{send:y,setOptions:v,queueMetrics:n,setLostConnection:S}}(jQuery)